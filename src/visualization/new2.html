<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
    <head>
        <script src="ammap/ammap.js" type="text/javascript"></script>
        <script src="ammap/maps/js/worldLow.js" type="text/javascript"></script>
        <script type="text/javascript" src="ammap/maps/js//themes/dark.js"></script>

    </head>
    <body>
        <script type="text/javascript">

            /*
             although ammap has methos like getAreaCenterLatitude and getAreaCenterLongitude,
             they are not suitable in quite a lot of cases as the center of some countries
             is even outside the country itself (like US, because of Alaska and Hawaii)
             That's why wehave the coordinates stored here
             */

            var latlong = {};
            latlong["0"] = {"latitude": 42.5, "longitude": 1.5};
            latlong["1"] = {"latitude": -13.8333, "longitude": -88.9167};
            latlong["2"] = {"latitude": -9, "longitude": -172};
            latlong["3"] = {"latitude": 8, "longitude": -66};


            var mapData = [
                {"code": "0", "name": "Cluster0", "value": 32358260, "color": "#eea638"},
                {"code": "1", "name": "Cluster1", "value": 32159880, "color": "#8aabb0"},
                {"code": "2", "name": "Cluster2", "value": 35980193, "color": "#de4c4f"},
                {"code": "3", "name": "Cluster3", "value": 39618432, "color": "#a7a737"}];


            var map;
            var minBulletSize = 3;
            var maxBulletSize = 70;
            var min = Infinity;
            var max = -Infinity;


// get min and max values
            for (var i = 0; i < mapData.length; i++) {
                var value = mapData[i].value;
                if (value < min) {
                    min = value;
                }
                if (value > max) {
                    max = value;
                }
            }

            // build map
            AmCharts.ready(function() {
                AmCharts.theme = AmCharts.themes.dark;
                map = new AmCharts.AmMap();
                map.pathToImages = "http://www.amcharts.com/lib/3/images/";

                map.addTitle("Population of the World in 2011", 14);
                map.addTitle("source: Gapminder", 11);
                map.areasSettings = {
                    unlistedAreasColor: "#000000",
                    unlistedAreasAlpha: 0.1
                };
                map.imagesSettings.balloonText = "<span style='font-size:14px;'><b>[[title]]</b>: [[value]]</span>";

                var dataProvider = {
                    mapVar: AmCharts.maps.worldLow,
                    images: []
                }

                // create circle for each country
                for (var i = 0; i < mapData.length; i++) {
                    var dataItem = mapData[i];
                    var value = dataItem.value;
                    // calculate size of a bubble
                    var size = (value - min) / (max - min) * (maxBulletSize - minBulletSize) + minBulletSize;
                    if (size < minBulletSize) {
                        size = minBulletSize;
                    }
                    var id = dataItem.code;

                    dataProvider.images.push({
                        type: "circle",
                        width: size,
                        height: size,
                        color: dataItem.color,
                        longitude: latlong[id].longitude,
                        latitude: latlong[id].latitude,
                        title: dataItem.name,
                        value: value
                    });
                }

                map.dataProvider = dataProvider;

                map.write("mapdiv");
            });



            function loadData(file) {
                var request;
                if (window.XMLHttpRequest) {
                    request = new XMLHttpRequest();
                    // load
                    request.open('GET', file, false);
                    request.send();
                    setData(request.responseText);
                }
            }


        </script>


        <script type="text/javascript">

            var map;

            AmCharts.ready(function() {
                map = new AmCharts.AmMap();
                map.pathToImages = "http://www.amcharts.com/lib/3/images/";

                map.colorSteps = 10;

                map.areasSettings = {
                    autoZoom: true
                };

                map.dataProvider = {};

                var valueLegend = new AmCharts.ValueLegend();
                valueLegend.right = 10;
                valueLegend.minValue = "little";
                valueLegend.maxValue = "a lot!";
                map.valueLegend = valueLegend;
                map.write("mapadiv");
            });

            function loadData(file) {
                var request;
                if (window.XMLHttpRequest) {
                    request = new XMLHttpRequest();
                    // load
                    request.open('GET', file, false);
                    request.send();
                    setData(request.responseText);
                }
            }

            function setData(data) {
                map.dataProvider = JSON.parse(data);
                map.validateNow();
            }




        </script>
        <a href="#" onclick="loadData('dataA.txt')">load data A</a>
        <div id="mapdiv" style="width: 600px; height: 400px;"></div>
        
        <div id="mapadiv" style="width: 100%; background-color:#EEEEEE; height: 500px;"></div>
    </body>
</html>